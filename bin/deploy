#!/usr/bin/env bash

if [ -f /opt/google-cloud-sdk/bin/gcloud ]; then
  gcloud=/opt/google-cloud-sdk/bin/gcloud
fi

if [ -f /opt/google-cloud-sdk/bin/kubectl ]; then
  kubectl=/opt/google-cloud-sdk/bin/kubectl
fi

VERSION = $(cat VERSION)

docker tag ledger-graph:${VERSION} gcr.io/api-dannydavidson-com/ledger-graph:${VERSION}
gcloud docker push gcr.io/api-dannydavidson-com/ledger-graph:${VERSION}

sed "s/{{LEDGER_GRAPH_VERSION}}/${VERSION}/g" ledger-graph.yml > ledger-graph.versioned.yml
kubectl apply -f ledger-graph.versioned.yml
